# Match... case... statements

## Exercise 6 (task)

The code opposite simulates a connection between two devices, managed using commands. Commands are passed to
`run_command` as tuples of a command name followed by its arguments. Each command has its own argument format, as
follows:

- Connect commands have the form `("connect", channel)` where `channel` is a string. When passed a well-formatted
  connect command, you should `print(f"Connecting to channel {channel}")`.
- All other commands have an argument `is_established` in the second position of the tuple. If passed any command with
  `is_established` equal to `False`, you should `print(f"Unable to execute {opcode}: connection not established")`,
  where `opcode` is the name of the command in the first position in the tuple.
- Synchronise commands have the form `("synchronise", is_established, timestamp)`. When passed a well-formatted
  synchronise command with `is_established` equal to `True`, if the timestamp is non-negative, you should
  `print(f"Synchronising to timestamp {timestamp}")`. If the timestamp is negative, `print("Invalid timestamp")`.
- Authenticate commands have the form `("authenticate", is_established, authenticator)` where `authenticator` is an
  instance of the `Authenticator` class. `Authenticator` is a dataclass with an attribute `password`. When passed a
  well-formatted authenticate command with `is_established` equal to `True`, check if the password is correctly given
  as `corect-horse-battery-staple`. If it is, call `authenticator.authenticate()`. Otherwise,
  `print("Couldn't authenticate connection")`.
- Send commands have two forms. They may be `("send", is_established, chks)`, where `chks` is a list of `Chunk`
  objects; or they may be `("send", is_established, dct)` where `dct` is a dictionary with, at least, a key `data`,
  which it associates to a list of `Chunk`s. In either case, when passed a well-formatted send command with
  `is_established` equal to `True`, inspect the list of chunks. If the first chunk has `is_header` set to `True`, skip
  it. (You don't need to check `is_header` on subsequent chunks). Then, if `chunks` is the list of non-skipped chunks,
  you should `print("".join(chunk.data for chunk in chunks))`. Note that the list of chunks may be empty, in which case
  you will print the empty string.
- If you are passed an ill-formatted command, you should `print("Malformed command")`. A command could be malformed if
  it doesn't have one of the recognised names, doesn't have the right number of elements in the tuple, has the wrong
  type for some elements in the tuple, or isn't a tuple. If a command has `is_established` set to `False` you may
  reject it for not having an established connection instead of for being malformed.

The program opposite contains many nested if statements, but it may be written as a single `match` statement with eight
`case` clauses, where the body of each case clause is a single print statement or call to `authenticate`. Rewrite it in
this form, keeping functionality exactly the same. You will need to make use of guard clauses, the `as` keyword, pipes,
unpacking, and various assignment structures.
